<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Panopto Canvas Prompt Builder</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  
  * { margin:0; padding:0; box-sizing:border-box; }
  
  :root {
    --qub: #E0001B;
    --qub-red: #E0001B;
    --primary: #E0001B;
    --primary-hover: #b00016;
    --primary-gradient: linear-gradient(135deg, #E0001B 0%, #ff4757 100%);
    --success: #34c759;
    --success-gradient: linear-gradient(135deg, #34c759 0%, #00d9ff 100%);
    --warning: #ff9500;
    --danger: #ff3b30;
    --bg: #fafafa;
    --bg-secondary: #ffffff;
    --bg-tertiary: #f0f2f5;
    --text: #0a0a0a;
    --text-secondary: #6b7280;
    --text-tertiary: #9ca3af;
    --border: #e5e7eb;
    --shadow: 0 4px 20px rgba(0,0,0,0.06);
    --shadow-md: 0 8px 30px rgba(0,0,0,0.08);
    --shadow-lg: 0 20px 60px rgba(0,0,0,0.12);
    --shadow-xl: 0 30px 80px rgba(0,0,0,0.15);
    --radius: 16px;
    --radius-lg: 24px;
    --radius-xl: 32px;
    --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --gradient-qub: linear-gradient(135deg, #E0001B 0%, #ff4757 50%, #ff6b81 100%);
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  @keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }
  
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    position: relative;
    overflow-x: hidden;
  }
  
  body::before {
    content: '';
    position: fixed;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(224,0,27,0.03) 0%, transparent 70%);
    animation: float 20s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }
  
  body::after {
    content: '';
    position: fixed;
    bottom: -50%;
    left: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(102,126,234,0.03) 0%, transparent 70%);
    animation: float 25s ease-in-out infinite reverse;
    pointer-events: none;
    z-index: 0;
  }
  
  /* Header */
  header {
    background: rgba(255,255,255,0.8);
    -webkit-backdrop-filter: blur(30px) saturate(180%);
    backdrop-filter: blur(30px) saturate(180%);
    border-bottom: 1px solid rgba(224,0,27,0.1);
    padding: 1.25rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: fadeInUp 0.6s ease-out;
  }
  
  header:hover {
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08);
  }
  
  .header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    z-index: 1;
  }
  
  .brand {
    display: flex;
    align-items: center;
    gap: 14px;
    position: relative;
    z-index: 1;
  }
  
  .brand img {
    height: 32px;
    transition: transform 0.3s ease;
    filter: drop-shadow(0 2px 8px rgba(224,0,27,0.15));
  }
  
  .brand img:hover {
    transform: scale(1.05);
  }
  
  .brand h1 {
    font-size: 1.35rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    font-size: 1.35rem;
    font-weight: 700;
  }
  
  .logo-icon {
    width: 42px;
    height: 42px;
    background: var(--gradient-qub);
    background-size: 200% 200%;
    animation: gradientShift 8s ease infinite;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 8px 24px rgba(224,0,27,0.25);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
  }
  
  .logo-icon::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
    transform: rotate(45deg);
    animation: shimmer 3s infinite;
  }
  
  .logo-icon:hover {
    transform: rotate(-5deg) scale(1.1);
    box-shadow: 0 12px 32px rgba(224,0,27,0.35);
  }
  
  /* Navigation Menu */
  .workflow-selector {
    display: flex;
    gap: 2rem;
    align-items: center;
  }
  
  .workflow-btn {
    padding: 0.625rem 0;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-secondary);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    letter-spacing: -0.01em;
  }
  
  .workflow-btn::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--gradient-qub);
    border-radius: 999px;
    transform: scaleX(0);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .workflow-btn:hover:not(.active) {
    color: var(--text);
  }
  
  .workflow-btn.active {
    color: var(--primary);
    font-weight: 700;
  }
  
  .workflow-btn.active::after {
    transform: scaleX(1);
  }
  
  /* Main Container */
  main {
    max-width: 1400px;
    margin: 0 auto;
    padding: 4rem 2rem;
    position: relative;
    z-index: 1;
  }
  
  /* Hero Banner */
  .hero-banner {
    position: relative;
    width: 100%;
    height: 400px;
    background: linear-gradient(135deg, rgba(224,0,27,0.85) 0%, rgba(147,51,234,0.85) 50%, rgba(59,130,246,0.85) 100%), 
                url('QUB-gallery-image-lanyon-building.jpg') center/cover;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
    overflow: hidden;
    margin-bottom: 4rem;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .hero-banner.quiz-hero {
    background: linear-gradient(135deg, rgba(224,0,27,0.85) 0%, rgba(147,51,234,0.85) 50%, rgba(59,130,246,0.85) 100%), 
                url('QUB-gallery-image-lanyon-building.jpg') center/cover;
  }
  
  .hero-banner.study-hero {
    background: linear-gradient(135deg, rgba(16,185,129,0.85) 0%, rgba(59,130,246,0.85) 100%), 
                url('QUB-gallery-image-lanyon-building.jpg') center/cover;
  }
  
  .hero-banner.notes-hero {
    background: linear-gradient(135deg, rgba(245,158,11,0.85) 0%, rgba(239,68,68,0.85) 100%), 
                url('1cdd84d4-b0ce-4901-9d10-6b47a02ed554.jpg') center/cover;
  }
  
  .hero-banner.help-hero {
    background: linear-gradient(135deg, rgba(124,58,237,0.85) 0%, rgba(236,72,153,0.85) 100%), 
                url('QUB-gallery-image-lanyon-building.jpg') center/cover;
  }
  
  .hero-banner::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 30% 50%, rgba(255,255,255,0.15) 0%, transparent 50%);
    animation: float 20s ease-in-out infinite;
  }
  
  .hero-content {
    position: relative;
    z-index: 1;
    max-width: 900px;
    padding: 0 2rem;
    animation: fadeInUp 0.8s ease-out 0.2s both;
  }
  
  .hero-title {
    font-size: 4rem;
    font-weight: 800;
    line-height: 1.1;
    margin: 0 0 1.5rem;
    letter-spacing: -0.03em;
    text-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }
  
  .hero-subtitle {
    font-size: 1.5rem;
    line-height: 1.6;
    margin: 0;
    opacity: 0.95;
    font-weight: 400;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
  }
  
  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1.25rem;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 999px;
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    border: 1px solid rgba(255,255,255,0.3);
  }
  
  /* Hero Section */
  .hero {
    max-width: 1000px;
    margin: 0 auto 4rem;
    text-align: center;
    display: none;
  }
  
  .hero h2 {
    font-size: 3.5rem;
    font-weight: 800;
    line-height: 1.1;
    margin: 0 0 1.5rem;
    letter-spacing: -0.03em;
    background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
  }
  
  .hero h2::after {
    content: '';
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 5px;
    background: var(--gradient-qub);
    border-radius: 999px;
    opacity: 0.6;
  }
  
  .hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 680px;
    margin: 0 auto;
    line-height: 1.7;
    font-weight: 400;
  }
  
  .hero-sub {
    max-width: 920px;
    margin: 12px auto 0;
    color: var(--text-tertiary);
  }
  
  .info {
    max-width: 920px;
    margin: 2rem auto;
    padding: 2rem;
    border: 1px solid rgba(224,0,27,0.1);
    border-radius: var(--radius-lg);
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
    -webkit-backdrop-filter: blur(20px);
    backdrop-filter: blur(20px);
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
    display: none;
  }
  
  .info.show {
    display: block;
    animation: fadeInUp 0.4s ease-out both;
  }
  
  .info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-qub);
  }
  
  /* Help Button */
  .help-toggle {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 999;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.75rem;
    background: linear-gradient(135deg, #7c3aed 0%, #a855f7 50%, #d946ef 100%);
    color: white;
    border: none;
    border-radius: 999px;
    font-size: 1.0625rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 8px 24px rgba(124,58,237,0.3);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .help-toggle:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 0 12px 32px rgba(124,58,237,0.5);
    background: linear-gradient(135deg, #6d28d9 0%, #9333ea 50%, #c026d3 100%);
  }
  
  .help-toggle-icon {
    font-size: 1.5rem;
    line-height: 1;
  }
  
  /* Quick Start Section */
  .quick-start {
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    padding: 3rem;
    margin-bottom: 3rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border);
    animation: fadeInUp 0.8s ease-out 0.3s both;
  }
  
  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }
  
  .preset-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1.25rem;
    margin-bottom: 2rem;
  }
  
  .preset-card {
    background: white;
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 2rem;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  
  .preset-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-qub);
    opacity: 0;
    transition: opacity 0.4s;
    z-index: 0;
  }
  
  .preset-card:hover {
    border-color: var(--primary);
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-xl);
  }
  
  .preset-card:hover::before {
    opacity: 0.03;
  }
  
  .preset-card.active {
    border-color: var(--primary);
    background: linear-gradient(135deg, rgba(224,0,27,0.05) 0%, rgba(224,0,27,0.02) 100%);
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
  }
  
  .preset-icon {
    font-size: 3rem;
    margin-bottom: 0.75rem;
    position: relative;
    z-index: 1;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .preset-card:hover .preset-icon {
    transform: scale(1.2) rotate(-5deg);
  }
  
  .preset-name {
    font-weight: 700;
    margin-bottom: 0.5rem;
    font-size: 1.125rem;
    position: relative;
    z-index: 1;
    letter-spacing: -0.01em;
  }
  
  .preset-desc {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 1.6;
    position: relative;
    z-index: 1;
  }
  
  /* Primary Action */
  .primary-action {
    text-align: center;
    margin: 3rem 0;
  }
  
  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.125rem 2.5rem;
    background: linear-gradient(135deg, #7c3aed 0%, #a855f7 50%, #d946ef 100%);
    background-size: 200% 200%;
    color: white;
    border: none;
    border-radius: var(--radius);
    font-size: 1.125rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 8px 24px rgba(124,58,237,0.3);
    position: relative;
    overflow: hidden;
    letter-spacing: -0.01em;
  }
  
  .btn-primary::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
    transform: rotate(45deg);
    animation: shimmer 3s infinite;
  }
  
  .btn-primary:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 16px 40px rgba(124,58,237,0.45);
    background: linear-gradient(135deg, #6d28d9 0%, #9333ea 50%, #c026d3 100%);
    background-position: 100% 50%;
  }
  
  .btn-primary:active {
    transform: translateY(-2px) scale(0.98);
  }
  
  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }
  
  .btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.875rem 1.75rem;
    background: white;
    color: var(--text);
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    letter-spacing: -0.01em;
  }
  
  .btn-secondary:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
  }
  
  .btn-secondary:active {
    transform: translateY(-1px);
  }
  
  /* Advanced Options (Collapsible) */
  .advanced-options {
    background: white;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
    overflow: hidden;
    animation: fadeInUp 0.8s ease-out 0.5s both;
  }
  
  .advanced-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 2rem;
    cursor: pointer;
    -webkit-user-select: none;
    user-select: none;
    transition: all 0.3s;
  }
  
  .advanced-header:hover {
    background: linear-gradient(135deg, rgba(224,0,27,0.02) 0%, transparent 100%);
  }
  
  .advanced-title {
    font-weight: 700;
    font-size: 1.25rem;
    letter-spacing: -0.02em;
  }
  
  .advanced-toggle {
    color: var(--text-secondary);
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    font-size: 1.25rem;
  }
  
  .advanced-toggle.open {
    transform: rotate(180deg);
  }
  
  .advanced-content {
    display: none;
    padding: 0 2rem 2rem;
    border-top: 1px solid var(--border);
  }
  
  .advanced-content.open {
    display: block;
    animation: fadeInUp 0.4s ease-out;
  }
  
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .form-label {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text);
    letter-spacing: -0.01em;
  }
  
  input[type="text"],
  input[type="number"],
  select,
  textarea {
    padding: 0.875rem 1rem;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: inherit;
    background: white;
  }
  
  input:hover,
  select:hover,
  textarea:hover {
    border-color: var(--text-tertiary);
  }
  
  input:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(224,0,27,0.08);
    transform: translateY(-2px);
  }
  
  textarea {
    resize: vertical;
    min-height: 120px;
  }
  
  .chip-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 0.75rem;
  }
  
  .chip {
    padding: 0.625rem 1.125rem;
    background: white;
    border: 2px solid var(--border);
    border-radius: 999px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    letter-spacing: -0.01em;
    position: relative;
    overflow: hidden;
  }
  
  .chip::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-qub);
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 0;
  }
  
  .chip:hover {
    border-color: var(--primary);
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
  }
  
  .chip:hover::before {
    opacity: 0.05;
  }
  
  .chip.active {
    background: var(--gradient-qub);
    color: white !important;
    border-color: transparent;
    box-shadow: 0 6px 20px rgba(224,0,27,0.25);
    transform: translateY(-2px);
    position: relative;
    z-index: 2;
  }
  
  .chip.active::before {
    opacity: 1;
    z-index: -1;
  }
  
  .chip > * {
    position: relative;
    z-index: 3;
    color: inherit;
  }
  
  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  /* Preview Section */
  .preview-section {
    background: white;
    border-radius: var(--radius-xl);
    padding: 2rem;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
    animation: fadeInUp 0.8s ease-out 0.6s both;
    position: relative;
    overflow: hidden;
  }
  
  .preview-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: var(--gradient-qub);
  }
  
  .preview-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    padding-top: 0.5rem;
  }
  
  .preview-stats {
    display: flex;
    align-items: center;
    gap: 2rem;
    font-size: 0.9375rem;
    color: var(--text-secondary);
  }
  
  .stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .stat-value {
    font-weight: 700;
    color: var(--text);
    font-size: 1.125rem;
  }
  
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--success-gradient);
    color: white;
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(52,199,89,0.25);
    letter-spacing: -0.01em;
  }
  
  .status-badge.warning {
    background: linear-gradient(135deg, var(--warning) 0%, #ffa726 100%);
    box-shadow: 0 4px 12px rgba(255,149,0,0.25);
  }
  
  .status-badge.danger {
    background: linear-gradient(135deg, var(--danger) 0%, #ff6b6b 100%);
    box-shadow: 0 4px 12px rgba(255,59,48,0.25);
  }
  
  .preview-box {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 2rem;
    max-height: 500px;
    overflow-y: auto;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    position: relative;
  }
  
  .preview-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--gradient-qub);
    opacity: 0.3;
  }
  
  .preview-text {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', Consolas, monospace;
    font-size: 0.9375rem;
    line-height: 1.7;
    white-space: pre-wrap;
    color: var(--text);
    font-weight: 500;
  }
  
  .preview-placeholder {
    text-align: center;
    padding: 4rem 1rem;
    color: var(--text-secondary);
  }
  
  .preview-placeholder-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    opacity: 0.3;
    animation: float 3s ease-in-out infinite;
  }
  
  /* Progress Bar */
  .progress-bar {
    height: 6px;
    background: var(--bg-tertiary);
    border-radius: 999px;
    margin: 1.5rem 0;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
  }
  
  .progress-fill {
    height: 100%;
    background: var(--success-gradient);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 999px;
    box-shadow: 0 0 12px rgba(52,199,89,0.4);
  }
  
  .progress-fill.warning {
    background: linear-gradient(135deg, var(--warning) 0%, #ffa726 100%);
    box-shadow: 0 0 12px rgba(255,149,0,0.4);
  }
  
  .progress-fill.danger {
    background: var(--danger);
  }
  
  /* Toast */
  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: linear-gradient(135deg, #1d1d1f 0%, #2d2d2f 100%);
    color: white;
    padding: 1.25rem 2rem;
    border-radius: var(--radius-lg);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    gap: 1rem;
    transform: translateY(150%) scale(0.9);
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s;
    z-index: 10000;
    opacity: 0;
    font-weight: 600;
    letter-spacing: -0.01em;
    -webkit-backdrop-filter: blur(20px);
    backdrop-filter: blur(20px);
  }
  
  .toast.show {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  
  .toast::before {
    content: '✓';
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: var(--success-gradient);
    border-radius: 50%;
    font-size: 16px;
    font-weight: 700;
    box-shadow: 0 4px 12px rgba(52,199,89,0.4);
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .hero h2 {
      font-size: 2.5rem;
    }
    
    .preset-cards {
      grid-template-columns: 1fr;
    }
    
    .workflow-selector {
      flex-direction: column;
      width: 100%;
    }
    
    .header-content {
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .form-grid {
      grid-template-columns: 1fr;
    }
    
    .toast {
      left: 1rem;
      right: 1rem;
      bottom: 1rem;
    }
  }
  
  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 12px;
    height: 12px;
  }
  
  ::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 999px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--border) 0%, var(--text-tertiary) 100%);
    border-radius: 999px;
    border: 3px solid var(--bg-tertiary);
    transition: background 0.3s;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--text-tertiary) 0%, var(--text-secondary) 100%);
  }
  
  /* Hidden */
  .hidden {
    display: none !important;
  }
  
  /* Utility classes */
  .w-100 {
    width: 100%;
  }
  
  .min-h-200 {
    min-height: 200px;
  }
  
  .mt-1half {
    margin-top: 1.5rem;
  }
  
  /* Radio group styles */
  .radio-group {
    display: flex;
    gap: 1.25rem;
    align-items: center;
    flex-wrap: wrap;
  }
  
  .radio-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9375rem;
    font-weight: 500;
    transition: color 0.2s;
  }
  
  .radio-group label:hover {
    color: var(--primary);
  }
  
  .radio-group input[type="radio"] {
    width: 20px;
    height: 20px;
    accent-color: var(--primary);
    cursor: pointer;
  }
  
  /* Muted text */
  .muted {
    color: var(--text-secondary);
    font-size: 0.9375rem;
    line-height: 1.6;
    margin-top: 0.75rem;
  }
  
  /* Help text */
  .help {
    color: var(--text-secondary);
    font-size: 0.875rem;
    line-height: 1.6;
    margin-top: 0.5rem;
  }
  
  /* Helper message */
  .helper-message {
    background: linear-gradient(135deg, rgba(224,0,27,0.05) 0%, rgba(224,0,27,0.02) 100%);
    border-left: 4px solid var(--primary);
    padding: 1.25rem 1.5rem;
    border-radius: var(--radius);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    box-shadow: 0 4px 12px rgba(224,0,27,0.08);
  }
  
  .helper-message-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    color: var(--primary);
  }
  
  .helper-message-text {
    font-size: 0.9375rem;
    line-height: 1.7;
    color: var(--text);
  }
  
  .helper-message-text strong {
    font-weight: 700;
    color: var(--text);
  }
  
  /* Preview actions row */
  .preview-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
  }
  
  /* Utility classes additions */
  .centered {
    margin-left: auto;
    margin-right: auto;
  }
  
  .align-center {
    text-align: center;
  }
  
  .help {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }
  
  .kb {
    font-size: 0.8125rem;
    line-height: 1.45;
  }
  
  .tooltip {
    border-bottom: 1px dotted #8aa;
    cursor: help;
  }
  
  .row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  fieldset {
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 1.75rem 2rem;
    margin-bottom: 2rem;
    background: white;
    box-shadow: var(--shadow);
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  fieldset:hover {
    border-color: var(--text-tertiary);
    box-shadow: var(--shadow-md);
  }
  
  legend {
    font-weight: 700;
    padding: 0 0.75rem;
    color: var(--text);
    font-size: 1.125rem;
    letter-spacing: -0.01em;
  }
  
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: white;
    color: var(--text);
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    letter-spacing: -0.01em;
  }
  
  .btn:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }
  
  .btn:active {
    transform: translateY(0);
  }
  
  /* FAQ Section */
  .faq-section {
    max-width: 1200px;
    margin: 6rem auto 4rem;
    padding: 0 2rem;
    animation: fadeInUp 0.8s ease-out 0.7s both;
  }
  
  .gradient-title {
    font-size: 3.5rem;
    font-weight: 800;
    text-align: center;
    margin-bottom: 3rem;
    letter-spacing: -0.03em;
    line-height: 1.1;
    background: linear-gradient(135deg, #7c3aed 0%, #a855f7 25%, #d946ef 50%, #ec4899 75%, #f43f5e 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% auto;
    animation: gradientShift 8s ease infinite;
  }
  
  .faq-title {
    font-size: 3.5rem;
    font-weight: 800;
    text-align: center;
    margin-bottom: 3rem;
    letter-spacing: -0.03em;
    line-height: 1.1;
    background: linear-gradient(135deg, #7c3aed 0%, #a855f7 25%, #d946ef 50%, #ec4899 75%, #f43f5e 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% auto;
    animation: gradientShift 8s ease infinite;
  }
  
  .faq-items {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  
  .faq-item {
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .faq-item:hover {
    box-shadow: 0 12px 40px rgba(0,0,0,0.12);
    transform: translateY(-4px);
  }
  
  .faq-question {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.75rem 2rem;
    cursor: pointer;
    background: white;
    transition: all 0.3s;
    -webkit-user-select: none;
    user-select: none;
    gap: 1.5rem;
  }
  
  .faq-question:hover {
    background: linear-gradient(135deg, rgba(224,0,27,0.02) 0%, transparent 100%);
  }
  
  .faq-question-text {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text);
    letter-spacing: -0.01em;
    line-height: 1.5;
    flex: 1;
  }
  
  .faq-icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    font-size: 1.25rem;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .faq-item.open .faq-icon {
    transform: rotate(180deg);
    background: var(--gradient-qub);
    color: white;
    box-shadow: 0 4px 12px rgba(224,0,27,0.25);
  }
  
  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), padding 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0 2rem;
  }
  
  .faq-item.open .faq-answer {
    max-height: 500px;
    padding: 0 2rem 2rem;
  }
  
  .faq-answer-text {
    font-size: 1rem;
    line-height: 1.75;
    color: var(--text-secondary);
    padding-top: 0.5rem;
    border-top: 2px solid var(--bg-tertiary);
  }
  
  .faq-answer-text strong {
    color: var(--text);
    font-weight: 600;
  }
  
  .faq-answer-text ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }
  
  .faq-answer-text li {
    margin-bottom: 0.5rem;
  }
</style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="brand">
      <img src="Queen's Red Logo - Landscape.png" alt="Queen's University Belfast" />
      <h1>Prompt Builder</h1>
    </div>
    
    <div class="workflow-selector">
      <button class="workflow-btn active" data-tab="quiz">Canvas Quiz</button>
      <button class="workflow-btn" data-tab="study">Study Guide</button>
      <button class="workflow-btn" data-tab="notes">From Notes</button>
      <button class="workflow-btn" data-tab="help">Getting Started</button>
    </div>
  </div>
</header>

<!-- Hero Banner -->
<div class="hero-banner quiz-hero" id="heroBanner">
  <div class="hero-content">
    <div class="hero-badge">
      <span>✨</span>
      <span id="heroBadgeText">Powered by AI & Queen's Beyond Blended Pedagogy</span>
    </div>
    <h1 class="hero-title" id="heroTitle">Transform Your Lectures into Learning Resources</h1>
    <p class="hero-subtitle" id="heroSubtitle">Generate Canvas quizzes and study guides from your Panopto lectures in seconds—aligned with Queen's teaching excellence standards</p>
  </div>
</div>

<main>
  <!-- Help Info Boxes (Hidden by default) -->
  <div class="info" id="about">
    <div class="section-title">
      <strong>About this tool</strong>
      <button class="btn" id="dismissAbout" title="Hide this message">✕</button>
    </div>
    <p class="kb">Choose a pedagogy approach, customise your settings, then paste the prompt into the Copilot sidebar with your Panopto lecture open. Copilot reads your captions/slides and produces a Canvas-ready QTI zip and a lecturer PDF, using only your materials.</p>
  </div>
  
  <!-- Quiz Workflow -->
  <div class="workflow-content quiz-workflow">
    <h2 class="gradient-title" style="margin-top: 2rem; margin-bottom: 3rem;">Canvas Quiz Maker</h2>
    
    <div class="info" id="preflight">
      <div class="section-title">
        <strong>⚡ Panopto Preflight (1 minute)</strong>
        <button class="btn" id="hidePreflight" title="Hide this checklist">✕</button>
        </div>
      <ol class="kb" style="margin-top: 0.75rem; padding-left: 1.5rem;">
        <li style="margin-bottom: 0.5rem;">Open the full Panopto <em>Watch</em> page (not the small Canvas embed).</li>
        <li style="margin-bottom: 0.5rem;">Open <em>Captions</em> and <em>Contents/Slides</em> panels.</li>
        <li style="margin-bottom: 0.5rem;">Scroll the transcript to the bottom once (loads all captions).</li>
        <li>Open Copilot and enable <em>Use page content</em>/<em>Allow this page</em>.</li>
      </ol>
    </div>
    
    <!-- Customise Options (Now at Top) -->
    <div class="advanced-options" style="margin-bottom: 2rem;">
      <div class="advanced-header" id="advancedToggle">
        <span class="advanced-title">Customise Options</span>
        <span class="advanced-toggle open">▼</span>
      </div>
      <div class="advanced-content open" id="advancedContent">
        
        <div class="form-grid">
          
          <div class="form-group">
            <label class="form-label" for="quizLang">Language</label>
            <select id="quizLang" title="Output language and terminology style. Default: English (UK).">
              <option value="en-GB" selected>English (UK)</option>
              <option value="ga-IE">Irish</option>
              <option value="cy-GB">Welsh</option>
              <option value="fr-FR">French</option>
              <option value="es-ES">Spanish</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="quizCount">Questions per type</label>
            <input type="number" id="quizCount" min="1" max="12" value="3" title="How many items to generate for each selected question type.">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="quizFeedback">Feedback level</label>
            <select id="quizFeedback" title="What students will see after answering.">
              <option value="off">Off — no explanations</option>
              <option value="brief" selected>Brief — 1-sentence rationale for the correct answer</option>
              <option value="detailed">Detailed — explain the correct answer AND why each distractor is less accurate, with study tips</option>
            </select>
            <p class="help">This feedback appears to students when they review the Canvas quiz. It helps address misconceptions and supports revision.</p>
          </div>
        </div>
        
        <div class="form-group mt-1half">
          <label class="form-label">Pedagogy Preset</label>
          <select id="pedagogy" title="Sets tone and question style across disciplines.">
            <option>Concept Check (Retrieval)</option>
            <option>Worked Examples (Scaffolded)</option>
            <option>Case/Scenario-Based</option>
            <option>Debate / Critical Analysis</option>
            <option>Metacognitive Reflection</option>
            <option>Accessibility-First (UDL)</option>
          </select>
          <p class="help" id="pedBrief"></p>
        </div>
        
        <div class="form-group mt-1half">
          <label class="form-label">Question Types</label>
          <div class="chip-group" id="questionTypes"></div>
          <p class="help">Multiple Choice is a good default to check core understanding. You can add other Canvas-compatible types:
            <span class="tooltip" title="Multiple Answers: choose all that apply, scored with partial credit.">MA</span>,
            <span class="tooltip" title="True/False: two options; the prompt enforces valid structure in QTI.">TF</span>,
            <span class="tooltip" title="Short Answer: exact strings (or variants) are accepted.">SA</span>,
            <span class="tooltip" title="Essay: unscored text response; used as a fallback if a question can't be validated.">Essay</span>,
            <span class="tooltip" title="Numerical: exact value or tolerance range.">Numerical</span>,
            <span class="tooltip" title="Matching: valid pairs; if not possible, we auto-rewrite to MC/Essay.">Matching</span>.
          </p>
        </div>
        
    </div>
  </div>
  
    <!-- Primary Action -->
    <div class="primary-action">
      <button class="btn-primary" id="generateQuiz" onclick="alert('Quiz button clicked!'); copyPrompt();">
        📋 Copy Prompt to Clipboard
      </button>
    </div>
    
    <!-- Canvas How-To (Quiz Only) -->
    <div class="info" id="canvasHow">
      <div class="section-title">
        <strong>Using this in Canvas (New or Classic Quizzes)</strong>
        <button class="btn" id="hideCanvasHow" title="Hide instructions">✕</button>
        </div>
      <ol class="kb" style="margin-top: 1rem; padding-left: 1.5rem;">
        <li style="margin-bottom: 0.5rem;">Complete the Panopto preflight steps above (open Watch page, captions/slides panels, scroll transcript).</li>
        <li style="margin-bottom: 0.5rem;">Copy the prompt (button above) and paste it into Copilot sidebar. It will produce:
          <ul style="margin-top: 0.25rem; padding-left: 1.5rem;"><li>A QTI <code>.zip</code> for Canvas</li><li>A lecturer PDF</li></ul>
        </li>
        <li style="margin-bottom: 0.5rem;"><strong>Import to Canvas:</strong> In your course, go to <strong>Settings → Import Course Content → Content Type: QTI .zip file</strong>. Choose the downloaded ZIP and click <strong>Import</strong>.</li>
        <li style="margin-bottom: 0.5rem;">After import, check <strong>Quizzes</strong> (or <strong>Assignments</strong> for New Quizzes). If you only see an item bank, the importer auto-rewrote items—open the bank and build a quiz from it.</li>
        <li>Review points, feedback, and availability dates; then publish.</li>
      </ol>
      <p class="help" style="margin-top: 0.75rem;"><strong>Note:</strong> If Copilot returns "INSUFFICIENT_PAGE_CONTENT", go back and ensure captions/contents panels are fully expanded and loaded.</p>
      </div>
    </div>
    
  <!-- Study Guide Workflow -->
  <div class="workflow-content study-workflow hidden">
    <h2 class="gradient-title" style="margin-top: 2rem; margin-bottom: 3rem;">Study Guide Builder</h2>
    
    <!-- Study Guide Options -->
    <div class="advanced-options" style="margin-bottom: 2rem;">
      <div class="advanced-header" id="studyAdvancedToggle">
        <span class="advanced-title">Customise Study Guide</span>
        <span class="advanced-toggle open">▼</span>
      </div>
      <div class="advanced-content open" id="studyAdvancedContent">
        
        <div class="form-group">
          <label class="form-label">Pedagogy Preset</label>
          <select id="studyPedagogy" title="Sets tone and structure across disciplines." onchange="state.studyPedagogy = this.value; document.getElementById('studyPedBrief').textContent = PEDAGOGY[this.value].brief; render();">
            <option>Concept Check (Retrieval)</option>
            <option>Worked Examples (Scaffolded)</option>
            <option>Case/Scenario-Based</option>
            <option>Debate / Critical Analysis</option>
            <option>Metacognitive Reflection</option>
            <option>Accessibility-First (UDL)</option>
          </select>
          <p class="help" id="studyPedBrief"></p>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Output Format</label>
            <div class="radio-group" style="gap:14px;">
              <label><input type="radio" name="sgFormat" value="pdf" onchange="state.sgFormat = this.value; render();"> PDF (A4)</label>
              <label><input type="radio" name="sgFormat" value="docx" checked onchange="state.sgFormat = this.value; render();"> Word (.docx)</label>
              <label><input type="radio" name="sgFormat" value="pptx" onchange="state.sgFormat = this.value; render();"> PPTX (16:9)</label>
            </div>
            <p class="help">Choose Word for editable study guides you can customise before distributing to students.</p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="studyDepth">Depth</label>
            <select id="studyDepth" onchange="state.studyDepth = this.value; render();">
              <option value="quick">Quick (10–12 pages) — 20–30 flashcards, 6–8 problems, concise explanations</option>
              <option value="standard" selected>Standard (18–25 pages) — 25–40 flashcards, 10–15 problems, fuller detail</option>
              <option value="deep">Deep (30–40 pages) — 35–50 flashcards, 12–18 problems, extensive explanations</option>
            </select>
            <p class="help">Depth controls thoroughness and quantity. Use Components below to choose which sections to include.</p>
          </div>
        </div>
        
        <div class="form-group mt-1half">
          <label class="form-label">Components (untick to exclude)</label>
          <div class="chip-group" id="studyComponents"></div>
          <p class="help">All ticked components will be included regardless of depth. Depth only affects detail level and quantity.</p>
        </div>
        
      </div>
        </div>
        
    <!-- Primary Action -->
    <div class="primary-action">
      <button class="btn-primary" id="generateStudy" onclick="alert('Button clicked!'); copyPrompt();">
        📋 Copy Prompt to Clipboard
      </button>
      <p class="help" style="margin-top: 0.5rem;">Paste into Copilot with your Panopto Watch page (captions & contents open).</p>
    </div>
  </div>
  
  <!-- From Notes Workflow -->
  <div class="workflow-content notes-workflow hidden">
    <h2 class="gradient-title" style="margin-top: 2rem; margin-bottom: 3rem;">Build From Your Notes</h2>
    
    <!-- Notes Input -->
    <div class="quick-start">
      <div class="section-title">Paste your notes</div>
      <textarea id="notesInput" placeholder="Paste your lecture notes here (plain text, headings, bullets)..." class="w-100 min-h-200"></textarea>
      <p class="help">Minimum 400 words recommended. Include headings and structure where possible.</p>
    </div>
    
    <!-- Notes Options -->
    <div class="advanced-options" style="margin-bottom: 2rem;">
      <div class="advanced-header" id="notesAdvancedToggle">
        <span class="advanced-title">Customise Output</span>
        <span class="advanced-toggle open">▼</span>
        </div>
      <div class="advanced-content open" id="notesAdvancedContent">
        
        <div class="form-group">
          <label class="form-label">Pedagogy Preset</label>
          <select id="notesPedagogy" title="Sets tone and structure." onchange="state.notesPedagogy = this.value; document.getElementById('notesPedBrief').textContent = PEDAGOGY[this.value].brief; render();">
            <option>Concept Check (Retrieval)</option>
            <option>Worked Examples (Scaffolded)</option>
            <option>Case/Scenario-Based</option>
            <option>Debate / Critical Analysis</option>
            <option>Metacognitive Reflection</option>
            <option>Accessibility-First (UDL)</option>
          </select>
          <p class="help" id="notesPedBrief"></p>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Output Format</label>
            <div class="radio-group" style="gap:14px;">
              <label><input type="radio" name="notesFormat" value="pdf" onchange="state.notesFormat = this.value; render();"> PDF (A4)</label>
              <label><input type="radio" name="notesFormat" value="docx" checked onchange="state.notesFormat = this.value; render();"> Word (.docx)</label>
              <label><input type="radio" name="notesFormat" value="pptx" onchange="state.notesFormat = this.value; render();"> PPTX (16:9)</label>
        </div>
            <p class="help">Choose Word to edit and customise the study materials before sharing.</p>
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- Primary Action -->
    <div class="primary-action">
      <button class="btn-primary" id="generateNotes" onclick="alert('Notes button clicked!'); copyPrompt();">
        📋 Copy Prompt to Clipboard
      </button>
      <p class="help" style="margin-top: 0.5rem;">Paste into Copilot (no Panopto page needed for this workflow).</p>
    </div>
  </div>
  
  <!-- Preview Section (Shared) -->
  <div class="preview-section centered">
    <div class="preview-header">
      <div class="section-title">Your Copilot Prompt</div>
      <div class="preview-stats">
        <div class="stat">
          <span>📊</span>
          <span><span class="stat-value" id="charCount">0</span> chars (aim &lt; 8000)</span>
        </div>
        <span class="status-badge" id="statusBadge">
          <span>✓</span>
          <span id="statusText">Ready</span>
        </span>
      </div>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progressBar"></div>
    </div>
    
    <div class="preview-actions" style="margin: 1rem 0; justify-content: space-between;">
      <span class="help">Paste into Copilot with your Panopto Watch page open. Ensure preflight steps are done.</span>
      <button class="btn-primary" id="copyTop" title="Copy the prompt" onclick="alert('copyTop clicked!'); copyPrompt();">📋 Copy Prompt</button>
    </div>
    
    <div class="preview-box">
      <div class="preview-placeholder" id="previewPlaceholder">
        <div class="preview-placeholder-icon">👆</div>
        <p>Customise your options above and your prompt will appear here</p>
      </div>
      <pre class="preview-text hidden" id="previewText"></pre>
    </div>
  </div>
  
  <!-- Help/Getting Started Workflow -->
  <div class="workflow-content help-workflow hidden">
    <h2 class="gradient-title" style="margin-top: 0;">Getting Started with Prompt Builder</h2>
    
    <div class="quick-start" style="margin-bottom: 4rem; padding: 3rem;">
      <h3 style="font-size: 1.75rem; margin-bottom: 1.5rem; color: var(--text);">Quick Start Guide</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        <div style="padding: 2.5rem; background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(147,51,234,0.05) 100%); border-radius: var(--radius-lg); border-left: 5px solid #3b82f6; box-shadow: 0 4px 20px rgba(59,130,246,0.1); transition: all 0.3s ease;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">🎥</div>
          <h4 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.75rem; background: linear-gradient(135deg, #3b82f6 0%, #9333ea 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Open Your Panopto Video</h4>
          <p style="color: var(--text-secondary); line-height: 1.6;">Navigate to your Panopto Watch page (not the Canvas embed). Ensure captions and slides panels are open and scroll through the transcript once.</p>
        </div>
        
        <div style="padding: 2.5rem; background: linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(236,72,153,0.05) 100%); border-radius: var(--radius-lg); border-left: 5px solid #a855f7; box-shadow: 0 4px 20px rgba(168,85,247,0.1); transition: all 0.3s ease;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">⚙️</div>
          <h4 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.75rem; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Customise Your Settings</h4>
          <p style="color: var(--text-secondary); line-height: 1.6;">Choose your pedagogy preset, question types, feedback level, and other options. The prompt updates automatically as you make changes.</p>
        </div>
        
        <div style="padding: 2.5rem; background: linear-gradient(135deg, rgba(236,72,153,0.1) 0%, rgba(244,63,94,0.05) 100%); border-radius: var(--radius-lg); border-left: 5px solid #ec4899; box-shadow: 0 4px 20px rgba(236,72,153,0.1); transition: all 0.3s ease;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">✨</div>
          <h4 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.75rem; background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Copy & Paste to Copilot</h4>
          <p style="color: var(--text-secondary); line-height: 1.6;">Click "Copy Prompt" and paste it into Microsoft Copilot's sidebar. Copilot will read your Panopto page and generate your quiz or study guide!</p>
        </div>
      </div>
    </div>
    
    <h2 class="faq-title">Frequently Asked Questions</h2>
    
    <div class="faq-items">
      <div class="faq-item">
        <div class="faq-question">
          <span class="faq-question-text">How do I use the Prompt Builder with Panopto?</span>
          <div class="faq-icon">›</div>
        </div>
        <div class="faq-answer">
          <div class="faq-answer-text">
            <p><strong>Step-by-step (about 2 minutes):</strong></p>
            <ol>
              <li>Open your Panopto <em>Watch</em> page in a browser tab (avoid the small Canvas embed).</li>
              <li>Open the <strong>Captions/Transcript</strong> panel and the <strong>Contents/Slides</strong> panel. Scroll through the transcript once so all captions load.</li>
              <li>Open <strong>Microsoft Copilot</strong> in the sidebar and allow it to “Use page content”.</li>
              <li>In Prompt Builder, choose your <strong>Pedagogy preset</strong>, keep <strong>Multiple Choice</strong> as default (or add more types), and set the <strong>Feedback level</strong>.</li>
              <li>Click <strong>Copy Prompt</strong> and paste it into Copilot. It will read <em>only</em> your Panopto page (captions + slides) and generate the requested files.</li>
            </ol>
            <p class="help">Tip: If Copilot returns <code>INSUFFICIENT_PAGE_CONTENT</code>, reload the Panopto page, open both panels, scroll to the bottom of the transcript, and try again.</p>
          </div>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question">
          <span class="faq-question-text">What outputs does the Prompt Builder create?</span>
          <div class="faq-icon">›</div>
        </div>
        <div class="faq-answer">
          <div class="faq-answer-text">
            <ul>
              <li><strong>Canvas Quiz package (QTI .zip):</strong> Standards‑compliant file that imports into Canvas (New or Classic Quizzes). Includes question stems, options, scoring, and optional per‑choice feedback.</li>
              <li><strong>Lecturer PDF (quiz version):</strong> One page per question with the answer key and concise teaching notes to help during delivery.</li>
              <li><strong>Study Guide / Notes Pack:</strong> A pedagogy‑first resource (PDF, Word, or PPTX) containing an executive summary, learning outcomes, key concepts, worked examples or cases, a problem set with solutions, 20–40 flashcards, reflection prompts and (optionally) a two‑week study planner.</li>
            </ul>
            <p class="help">All outputs are created from your lecture materials only—no external sources are introduced.</p>
          </div>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question">
          <span class="faq-question-text">What are pedagogy presets and how do I choose one?</span>
          <div class="faq-icon">›</div>
        </div>
        <div class="faq-answer">
          <div class="faq-answer-text">
            <p>Presets shape the <strong>tone, structure and feedback style</strong> of what is generated, aligned with Queen’s <em>Beyond Blended</em> approach:</p>
            <ul>
              <li><strong>Concept Check (Retrieval):</strong> Short, focused questions that probe essential ideas and common misconceptions.</li>
              <li><strong>Worked Examples (Scaffolded):</strong> Step‑by‑step reasoning with “why this step” notes and common slips.</li>
              <li><strong>Case/Scenario‑Based:</strong> Realistic vignettes that ask students to apply ideas; one answer is most defensible from the lecture.</li>
              <li><strong>Debate / Critical Analysis:</strong> Contrast positions and justify the preferred option using evidence from slides/captions.</li>
              <li><strong>Metacognitive Reflection:</strong> Prompts that surface process, limits and next steps (great for short‑answer / essay).</li>
              <li><strong>Accessibility‑First (UDL):</strong> Plain UK English, clear structure, and inclusive phrasing; avoids jargon and culture‑bound idioms.</li>
            </ul>
            <p class="help">Choose the preset that matches your intended learning outcome. You can still edit the prompt details before copying.</p>
          </div>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question">
          <span class="faq-question-text">How do I import the quiz into Canvas?</span>
          <div class="faq-icon">›</div>
        </div>
        <div class="faq-answer">
          <div class="faq-answer-text">
            <ol>
              <li>In your Canvas course go to <strong>Settings → Import Course Content</strong>.</li>
              <li>Set <strong>Content Type</strong> to <strong>QTI .zip file</strong>, choose the downloaded file (e.g., <code>Lecture_5_…_quiz_qti.zip</code>) and click <strong>Import</strong>.</li>
              <li>After processing, check <strong>Quizzes</strong>. For New Quizzes, the item also appears in <strong>Assignments</strong>.</li>
              <li>If you only see an <strong>Item Bank</strong>, open it and build a quiz from those questions—Canvas sometimes does this automatically.</li>
              <li>Open the quiz to review points, availability, and <strong>Student Feedback</strong> settings; then <strong>Publish</strong>.</li>
            </ol>
            <p class="help">Troubleshooting: If Canvas shows “No question type used…”, the QTI was malformed. Regenerate using this tool’s latest prompt and ensure only Canvas‑supported types are selected.</p>
          </div>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question">
          <span class="faq-question-text">Can I customize the generated content?</span>
          <div class="faq-icon">›</div>
        </div>
        <div class="faq-answer">
          <div class="faq-answer-text">
            <p><strong>Yes.</strong> The app lets you tailor:</p>
            <ul>
              <li><strong>Question types & counts:</strong> Start with Multiple Choice, then add others as needed.</li>
              <li><strong>Feedback level:</strong> Off, Brief, or Detailed—controls what students see after answering.</li>
              <li><strong>Pedagogy preset:</strong> Sets style, depth and feedback tone.</li>
              <li><strong>Study Guide components:</strong> Toggle concept map, glossary, worked examples, cases, problem set, flashcards, reflections and planner.</li>
              <li><strong>Output format:</strong> PDF/Word/PPTX for study guides; QTI + PDF for quizzes.</li>
            </ul>
            <p class="help">Everything generated is editable: you can revise wording in the PDF/Word/PPTX and change quiz settings in Canvas.</p>
          </div>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question">
          <span class="faq-question-text">Is my content secure and private?</span>
          <div class="faq-icon">›</div>
        </div>
        <div class="faq-answer">
          <div class="faq-answer-text">
            <p>This tool runs entirely in your browser and only creates a <em>prompt</em>. Your materials are not uploaded to our servers. When you paste the prompt into Microsoft Copilot, your data is handled under Microsoft’s terms and your institutional account settings.</p>
            <ul>
              <li>The prompt instructs Copilot to use <strong>only</strong> your Panopto captions/slides or notes and to avoid external sources.</li>
              <li>No student data is processed.</li>
              <li>Generated files are saved locally by you.</li>
            </ul>
            <p class="help"><strong>Disclaimer:</strong> We aim for accuracy and accessibility, but AI outputs can contain errors or omissions. Always review before sharing with students. If you spot an issue, regenerate or edit the output.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <footer style="max-width:1400px;margin:3rem auto 2rem;padding:1.5rem 2rem;border-top:2px solid var(--border);text-align:center;color:var(--text-secondary);">
    <p style="margin-bottom:0.5rem;"><strong>Teaching & Training Unit – D&IS, Queen’s University Belfast</strong></p>
    <p style="margin-bottom:0.5rem;">Patrick Phillips • Support & enquiries: <em>please contact via Teams or University email</em></p>
    <p style="font-size:0.875rem;">We strive to create high‑quality resources aligned with Queen’s pedagogy. However, AI‑generated content may contain inaccuracies. Always review outputs for accuracy, inclusivity and accessibility before use.</p>
  </footer>
</main>

<!-- Help Button -->
<button class="help-toggle" id="helpToggle">
  <span class="help-toggle-icon">?</span>
  <span>Need Help?</span>
</button>

<!-- Toast Notification -->
<div class="toast" id="toast">
  <span>✓</span>
  <span>Prompt copied to clipboard!</span>
</div>

<script>
// Pedagogy presets (QUB-aligned)
const PEDAGOGY = {
  "Concept Check (Retrieval)": {
    brief: "Quick checks of core ideas. Tight stems, one clearly best answer, and distractors based on likely misunderstandings.",
    inject: [
      "Use retrieval-practice style questions that check essential concepts from the lecture.",
      "Distractors must reflect plausible misunderstandings taken from the lecture wording only.",
      "Brief feedback explains the correct idea and points to a timestamp if detectable."
    ]
  },
  "Worked Examples (Scaffolded)": {
    brief: "Step-by-step problem solving with hints that fade. Great for methods and processes.",
    inject: [
      "Prefer worked-example prompts with ordered steps.",
      "Add a short 'why this step' note; in detailed feedback include 'common slip' guidance."
    ]
  },
  "Case/Scenario-Based": {
    brief: "Apply the lecture ideas to realistic situations; one answer is most defensible from the material.",
    inject: [
      "Frame items as short scenarios derived strictly from lecture captions/slides.",
      "Provide one best answer; others can be reasonable but less supported."
    ]
  },
  "Debate / Critical Analysis": {
    brief: "Compare viewpoints; justify the preferred answer with evidence from the lecture.",
    inject: [
      "Pose contrastive options; mark the one most defensible by the lecture evidence.",
      "Feedback references the relevant slide/timestamp where possible."
    ]
  },
  "Metacognitive Reflection": {
    brief: "Students reflect on process, limits, and next steps. Good as SA/Essay.",
    inject: [
      "Include prompts that ask students to explain approach and next steps tied to outcomes.",
      "Prefer short-answer or essay for depth where MC is weak."
    ]
  },
  "Accessibility-First (UDL)": {
    brief: "Plain UK English, inclusive phrasing, and multiple means of representation.",
    inject: [
      "Ensure each item stands alone without images; suggest alt text when PDF is generated.",
      "Avoid idioms and culturally specific references."
    ]
  }
};

// State
let state = {
  workflow: 'quiz',
  pedagogy: 'Concept Check (Retrieval)',
  quizTitle: '',
  quizLang: 'en-GB',
  quizCount: 3,
  quizFeedback: 'brief',
  questionTypes: ['multiple_choice_question'],
  
  // Study Guide
  studyPedagogy: 'Concept Check (Retrieval)',
  sgFormat: 'docx',
  studyDepth: 'standard',
  studyComponents: {
    conceptMap: true,
    glossary: true,
    worked: true,
    problems: true,
    cases: true,
    selfcheck: true,
    reflect: true,
    planner: true
  },
  
  // From Notes
  notesPedagogy: 'Concept Check (Retrieval)',
  notesFormat: 'docx',
  notesInput: ''
};

const STUDY_COMPONENTS = [
  { id: 'conceptMap', label: 'Concept Map' },
  { id: 'glossary', label: 'Glossary' },
  { id: 'worked', label: 'Worked Examples' },
  { id: 'problems', label: 'Problem Set' },
  { id: 'cases', label: 'Case Vignettes' },
  { id: 'selfcheck', label: 'Self-Check Quiz' },
  { id: 'reflect', label: 'Reflection Prompts' },
  { id: 'planner', label: 'Study Planner' }
];

const QUESTION_TYPES = [
  { id: 'multiple_choice_question', label: 'Multiple Choice' },
  { id: 'multiple_answers_question', label: 'Multiple Answers' },
  { id: 'true_false_question', label: 'True/False' },
  { id: 'short_answer_question', label: 'Short Answer' },
  { id: 'essay_question', label: 'Essay' },
  { id: 'numerical_question', label: 'Numerical' },
  { id: 'matching_question', label: 'Matching' }
];

// DOM helpers
const $ = id => document.getElementById(id);
const $$ = sel => document.querySelectorAll(sel);

// Detect Panopto title (enhanced)
function detectPanoptoTitle() {
  const og = document.querySelector('meta[property="og:title"]')?.content?.trim();
  const data = document.querySelector('[data-role="session-title"], .session-title, .video-title')?.textContent?.trim();
  const doc = document.title?.trim();
  return og || data || doc || '';
}

const panoptoTitle = detectPanoptoTitle();

function slugify(s) {
  const a = (s || '').normalize('NFKD').replace(/[^\x00-\x7F]/g, '');
  return (a.replace(/[^A-Za-z0-9]+/g, '_').replace(/_+/g, '_').replace(/^_+|_+$/g, '') || 'Lecture_Quiz');
}

// Panopto source block (compact)
const PANOPTO_BLOCK = `SOURCE: Read THIS Panopto page DOM: (1) Full captions/transcript, (2) Slides/contents, (3) Notes panel.

TITLE EXTRACTION (MANDATORY): Extract real video title from: <meta property="og:title">, [data-role="session-title"], h1, or document.title. Use ACTUAL title (e.g., "Week 5: Cell Division") NOT "Lecture Quiz" or placeholders. Use in filenames and file content.

FAIL-CLOSED: If <300 words after dedupe, return: "INSUFFICIENT_PAGE_CONTENT — Open captions+slides panels, scroll transcript, then retry." No files.`;

// Prompt builders
function buildQuizPrompt() {
  const title = panoptoTitle || 'Lecture Quiz';
  const slug = slugify(title);
  const types = state.questionTypes.join(', ');
  const target = state.questionTypes.length * state.quizCount;
  const ped = PEDAGOGY[state.pedagogy] || PEDAGOGY["Concept Check (Retrieval)"];
  const pedBlock = ped.inject.map(l => `• ${l}`).join('\n');
  
  let tfNum = '';
  if (state.questionTypes.includes('true_false_question')) tfNum += '\nTF: <response_lid> with 2 labels: True/False.';
  if (state.questionTypes.includes('numerical_question')) tfNum += '\nNUM: <response_num> + tolerance.';
  
  return `SYSTEM: Return EXACTLY 2 files: (1) ${slug}_quiz_qti.zip, (2) ${slug}_quiz.pdf
Use ONLY THIS Panopto page. Language=${state.quizLang}. Do NOT ask questions.
${PANOPTO_BLOCK}
PEDAGOGY: ${pedBlock}

HE STANDARDS: Clear stems testing outcomes (not trivia); plausible distractors from lecture; meaningful feedback explaining WHY with timestamps; mix Bloom levels; university-level precision.

Q TYPES: ${types} | ${state.quizCount} per type | TARGET=${target} exactly | Rewrite invalid as essay${tfNum}

QTI ZIP — ${slug}_quiz_qti.zip:
imsmanifest.xml:
<?xml version="1.0" encoding="UTF-8"?>
<manifest identifier="man1" xmlns="http://www.imsglobal.org/xsd/imscp_v1p1">
  <resources><resource identifier="res1" type="imsqti_xmlv1p2" href="assessment.xml"><file href="assessment.xml"/></resource></resources>
</manifest>

assessment.xml:
<?xml version="1.0" encoding="UTF-8"?>
<questestinterop xmlns="http://www.imsglobal.org/xsd/ims_qtiasiv1p2">
  <assessment ident="asmt1" title="[ACTUAL_VIDEO_TITLE]"><section ident="root_section"><!-- ${target} items --></section></assessment>
</questestinterop>

MC ITEM:
<item ident="q1" title="Q1">
<itemmetadata><qtimetadata>
<qtimetadatafield><fieldlabel>question_type</fieldlabel><fieldentry>multiple_choice_question</fieldentry></qtimetadatafield>
<qtimetadatafield><fieldlabel>points_possible</fieldlabel><fieldentry>1</fieldentry></qtimetadatafield>
</qtimetadata></itemmetadata>
<presentation><material><mattext texttype="text/html">STEM</mattext></material>
<response_lid ident="response1" rcardinality="Single"><render_choice shuffle="Yes">
<response_label ident="A"><material><mattext texttype="text/html">OPT_A</mattext></material></response_label>
<response_label ident="B"><material><mattext texttype="text/html">OPT_B</mattext></material></response_label>
<response_label ident="C"><material><mattext texttype="text/html">OPT_C</mattext></material></response_label>
<response_label ident="D"><material><mattext texttype="text/html">OPT_D</mattext></material></response_label>
</render_choice></response_lid></presentation>
<resprocessing><outcomes><decvar varname="SCORE" vartype="Decimal" minvalue="0" maxvalue="100"/></outcomes>
<respcondition continue="No"><conditionvar><varequal respident="response1">CORRECT</varequal></conditionvar>
<setvar varname="SCORE" action="Set">100</setvar>${state.quizFeedback !== 'off' ? '<displayfeedback feedbacktype="Response" linkrefid="fb"/>' : ''}</respcondition></resprocessing>${state.quizFeedback !== 'off' ? '<itemfeedback ident="fb"><material><mattext texttype="text/html">WHY correct [mm:ss]</mattext></material></itemfeedback>' : ''}
</item>

GUARDS: UTF-8; escape XML chars; mattext≤1200; exactly ${target} items; all have metadata

PDF: A4. Title=[ACTUAL_VIDEO_TITLE], TOC, then 1Q/page: number, stem, options, answer${state.quizFeedback !== 'off' ? ', feedback+timestamp' : ''}

VALIDATE: (1) ≥300w or "INSUFFICIENT_PAGE_CONTENT", (2) Real title extracted, (3) ${target} items, (4) Valid XML, (5) All metadata, (6) HE quality (clear/defensible/plausible/meaningful), (7) Mixed Bloom, (8) Expert-approvable

OUTPUT: [ACTUAL_TITLE_SLUG]_quiz_qti.zip + [ACTUAL_TITLE_SLUG]_quiz.pdf using REAL title from og:title/[data-role="session-title"]/h1/document.title—NOT "Lecture_Quiz" placeholder.`;
}

function buildStudyPrompt() {
  const panoptoTitle = detectPanoptoTitle();
  const title = panoptoTitle || 'Study Pack';
  const slug = slugify(title);
  const format = state.sgFormat;
  const depth = state.studyDepth;
  const ped = PEDAGOGY[state.studyPedagogy] || PEDAGOGY["Concept Check (Retrieval)"];
  const pedBlock = ped.inject.map(l => `• ${l}`).join('\n');
  const c = state.studyComponents;
  const ext = format === 'pptx' ? 'pptx' : (format === 'docx' ? 'docx' : 'pdf');
  const fmt = format === 'pptx' ? 'PPTX 16:9' : (format === 'docx' ? 'Word A4' : 'PDF A4');
  const pg = depth==='quick'?'10-12':depth==='standard'?'18-25':'30-40';
  const ts = depth==='quick'?'12':depth==='standard'?'20':'30';
  const fc = depth==='quick'?'20-30':depth==='standard'?'25-40':'35-50';
  const pr = depth==='quick'?'6-8':depth==='standard'?'10-15':'12-18';
  
  return `SYSTEM: Return ONE complete file: ${slug}_study.${ext}
Use ONLY Panopto page (captions+slides). Language=${state.quizLang}. Do NOT stop partway or ask to continue. Generate ALL sections in ONE output. ${pg}p guide now.
Extract REAL video title from og:title/[data-role="session-title"]/h1/document.title. Use it (NOT placeholder) in title+filename.
Source: transcript+slides+notes. Dedupe. Keep [mm:ss]. ≥500w or "INSUFFICIENT_CONTENT".
Brand: QUB red #E0001B; white bg; WCAG AA.
PEDAGOGY: ${pedBlock}
HE STANDARDS: Cognitive rigor (why not what); precise terminology; connections across topics; metacognition; ${ts}+ timestamps; university register; formative feedback.

STRUCTURE (omit unticked):
1) Title=[REAL_VIDEO_TITLE], module, date
2) How to use (≤150w): active recall, spaced, timestamps
3) Outcomes (4-8): Bloom-tagged
4) Key concepts (6-12): 2-3 sentences, links, IDs, [mm:ss]
${c.conceptMap?`5) Concept map: hierarchical, relationships, [mm:ss]\n`:''}${c.glossary?`6) Glossary (15-35): plain English, examples, [mm:ss]\n`:''}${c.worked?`7) Worked (3-6): steps, "why", errors, thinking, [mm:ss]\n`:''}${c.problems?`8) Problems (8-15): recall→extend; hints+solutions+rationale+[mm:ss]\n`:''}${c.cases?`9) Cases (3-5): scenarios, 4-6Q, teaching points, [mm:ss]\n`:''}10) Flashcards (${fc}): ID, Q (understanding not recall), A (precise), Explanation (connections), Source [mm:ss], Difficulty (Fdn/Int/Adv), Related. Appendix: CSV
${c.selfcheck?`11) Self-check (10-15): mixed; key=answer+rationale+misconceptions+[mm:ss]\n`:''}${c.reflect?`12) Reflection: confident/unclear/connections/approach\n`:''}${c.planner?`13) Planner (2-3wk): Day1 FC-01..15+prob1-4; Day3 self-test; Day7 quiz; Day14 full\n`:''}14) Rewatch (5-8 segments [mm:ss]+why+active)
15) Independent (150w): resources, self-assess, help
16) Accessibility: headings, contrast, plain English

FORMAT: ${fmt}; section/page; H1/H2; no splits; ${ts}+ [mm:ss]${format==='docx'?'; H1/H2 styles, TOC, editable':''}
DEPTH: ${fc} flashcards, ${pr} problems, ${pg}p, ${ts}+ [mm:ss]

VALIDATE: (1) ≥500w or INSUFFICIENT, (2) Real title extracted, (3) All sections, (4) ${ts}+ timestamps, (5) Flashcards: 7 fields + quality, (6) Expert reasoning, (7) Progress Fdn→Adv, (8) Metacognitive, (9) HE register, (10) Accessible, (11) ONE complete file—ALL sections
QUALITY: Lecturer-approvable? HE-level? Independent learning?

OUTPUT NOW: Complete ${ext} with REAL title (e.g., Lecture_5_Photosynthesis_Dr_Martinez_study.${ext}). ALL sections. No partials. Downloadable immediately.`;
}

function buildNotesPrompt() {
  const slug = 'Lecture_Notes_Pack';
  const format = state.notesFormat;
  const ped = PEDAGOGY[state.notesPedagogy] || PEDAGOGY["Concept Check (Retrieval)"];
  const pedBlock = ped.inject.map(l => `• ${l}`).join('\n');
  const ext = format === 'pptx' ? 'pptx' : (format === 'docx' ? 'docx' : 'pdf');
  const fmt = format === 'pptx' ? 'PPTX 16:9' : (format === 'docx' ? 'Word A4' : 'PDF A4');
  
  return `SYSTEM: Return ONE complete file: ${slug}.${ext}
Use ONLY notes below. Language=${state.quizLang}. Do NOT stop partway or ask to continue. Generate ALL 13 sections in ONE output. 25-35p guide now.
Parse headings/bullets; dedupe. Extract title (first heading). ≥400w or "INSUFFICIENT_CONTENT".

NOTES: ${state.notesInput || '[PASTE HERE]'}

PEDAGOGY: ${pedBlock}
HE STANDARDS + SOURCE FIDELITY: Every concept from notes (no invention); match lecturer terminology exactly; understanding not recall; scaffold accessible→advanced; connections; precise terms; inference limits; metacognition; HE depth.

STRUCTURE (all 13):
1) Title (from notes or "Notes Pack"), module, date
2) How to use (≤150w): active recall, spaced
3) Outcomes (4-8): Bloom-tagged
4) Key concepts (6-12): 2-3 sentences, links, IDs
5) Concept map: hierarchical, relationships
6) Glossary (12-30): plain English, examples
7) Worked (3-6) OR Cases (3-5): steps+"why", errors, thinking OR scenarios+Q+points
8) Problems (8-12): recall→extend; hints+solutions+rationale
9) Flashcards (25-45): ID, Q (retrieval), A, Explanation (why/connect), Difficulty (Fdn/Int/Adv), Related. Appendix: CSV
10) Self-check (10-15): mixed; key=correct+rationale+misconceptions
11) Reflection: confident/unclear/connections/approach
12) Independent (≤200w): resources, self-assess, help
13) Accessibility: headings, contrast, plain English

FORMAT: ${fmt}; section/page; H1/H2; no splits${format==='docx'?'; H1/H2 styles, TOC, editable':''}
DEPTH: 25-35p, 25-45 flashcards, 8-12 problems, 3-6 examples/cases

VALIDATE: (1) ≥400w or INSUFFICIENT, (2) Title from notes, (3) All 13 sections, (4) Flashcards: 6 fields + quality, (5) Progress Fdn→Adv, (6) Reasoning not just steps, (7) Metacognitive, (8) Register matches notes, (9) Accessible, (10) ONE complete file—ALL sections
SOURCE CHECK: Trace every concept to notes? No fabrication?
QUALITY: HE-level? Lecturer recognizes content? Thinking not recall?

OUTPUT NOW: Complete ${ext}. ALL 13 sections. No partials. Downloadable immediately.`;
}

// Render preview
function render() {
  console.log('Rendering for workflow:', state.workflow);
  let prompt = '';
  if (state.workflow === 'quiz') prompt = buildQuizPrompt();
  if (state.workflow === 'study') prompt = buildStudyPrompt();
  if (state.workflow === 'notes') prompt = buildNotesPrompt();
  
  console.log('Generated prompt length:', prompt.length);
  const len = prompt.length;
  $('charCount').textContent = len;
  
  // Update progress bar and status
  const pct = Math.min(100, (len / 8000) * 100);
  $('progressBar').style.width = pct + '%';
  
  if (len >= 8000) {
    $('progressBar').classList.add('danger');
    $('progressBar').classList.remove('warning');
    $('statusBadge').className = 'status-badge danger';
    $('statusText').textContent = 'Too long';
  } else if (len > 7500) {
    $('progressBar').classList.add('warning');
    $('progressBar').classList.remove('danger');
    $('statusBadge').className = 'status-badge warning';
    $('statusText').textContent = 'Near limit';
  } else {
    $('progressBar').classList.remove('danger', 'warning');
    $('statusBadge').className = 'status-badge';
    $('statusText').textContent = 'Ready';
  }
  
  // Show preview
  if (prompt) {
    $('previewPlaceholder').classList.add('hidden');
    $('previewText').classList.remove('hidden');
    $('previewText').textContent = prompt;
  } else {
    $('previewPlaceholder').classList.remove('hidden');
    $('previewText').classList.add('hidden');
  }
}

// Copy to clipboard
function copyPrompt() {
  console.log('=== COPY BUTTON CLICKED ===');
  console.log('Current workflow:', state.workflow);
  
  // Rebuild the prompt right now to ensure it's fresh
  let prompt = '';
  if (state.workflow === 'quiz') prompt = buildQuizPrompt();
  if (state.workflow === 'study') prompt = buildStudyPrompt();
  if (state.workflow === 'notes') prompt = buildNotesPrompt();
  
  console.log('Fresh prompt length:', prompt.length);
  console.log('First 100 chars:', prompt.substring(0, 100));
  
  if (!prompt || prompt.trim() === '') {
    console.error('No prompt generated!');
    alert('No prompt to copy yet. Please ensure you have selected your options.');
    return;
  }
  
  // Try to copy
  console.log('Attempting to copy...');
  if (navigator.clipboard && navigator.clipboard.writeText) {
    console.log('Using navigator.clipboard API');
    navigator.clipboard.writeText(prompt).then(() => {
      console.log('Copy successful!');
      // Show toast
      $('toast').classList.add('show');
      setTimeout(() => $('toast').classList.remove('show'), 2000);
      alert('Copied successfully! (' + prompt.length + ' characters)');
    }).catch(err => {
      console.error('Clipboard API failed:', err);
      alert('Failed to copy to clipboard: ' + err.message);
    });
  } else {
    console.log('Using fallback copy method');
    // Fallback for older browsers
    const ta = document.createElement('textarea');
    ta.value = prompt;
    ta.style.position = 'fixed';
    ta.style.top = '0';
    ta.style.left = '0';
    ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    try { 
      const success = document.execCommand('copy');
      console.log('execCommand copy result:', success);
      if (success) {
  // Show toast
  $('toast').classList.add('show');
  setTimeout(() => $('toast').classList.remove('show'), 2000);
        alert('Copied successfully! (' + prompt.length + ' characters)');
      } else {
        alert('Copy failed. Please try manually selecting and copying the text below.');
      }
    } catch(e) {
      console.error('execCommand failed:', e);
      alert('Failed to copy: ' + e.message);
    }
    document.body.removeChild(ta);
  }
}

// Init question type chips
function initQuestionTypes() {
  const container = $('questionTypes');
  container.innerHTML = '';
  QUESTION_TYPES.forEach(type => {
    const chip = document.createElement('div');
    chip.className = 'chip' + (state.questionTypes.includes(type.id) ? ' active' : '');
    chip.textContent = type.label;
    chip.onclick = () => {
      if (state.questionTypes.includes(type.id)) {
        state.questionTypes = state.questionTypes.filter(t => t !== type.id);
      } else {
        state.questionTypes.push(type.id);
      }
      chip.classList.toggle('active');
      render();
    };
    container.appendChild(chip);
  });
}

// Init study components chips
function initStudyComponents() {
  const container = $('studyComponents');
  if (!container) {
    console.warn('studyComponents container not found');
    return;
  }
  console.log('Initializing study components, current state:', state.studyComponents);
  container.innerHTML = '';
  STUDY_COMPONENTS.forEach(comp => {
    const chip = document.createElement('div');
    chip.className = 'chip' + (state.studyComponents[comp.id] ? ' active' : '');
    chip.textContent = comp.label;
    chip.onclick = () => {
      console.log('Component clicked:', comp.id, 'was:', state.studyComponents[comp.id]);
      state.studyComponents[comp.id] = !state.studyComponents[comp.id];
      chip.classList.toggle('active');
      console.log('Component now:', state.studyComponents[comp.id]);
  render();
    };
    container.appendChild(chip);
  });
}

// Init
function init() {
  // Update pedagogy brief on load (quiz)
  const p = PEDAGOGY[state.pedagogy];
  if (p) $('pedBrief').textContent = p.brief;
  
  // Update pedagogy brief on load (study guide)
  const sp = PEDAGOGY[state.studyPedagogy];
  if (sp && $('studyPedBrief')) $('studyPedBrief').textContent = sp.brief;
  
  // Update pedagogy brief on load (notes)
  const np = PEDAGOGY[state.notesPedagogy];
  if (np && $('notesPedBrief')) $('notesPedBrief').textContent = np.brief;
  
  // Help button - navigate to Getting Started page
  if ($('helpToggle')) {
    $('helpToggle').onclick = () => {
      $$('.workflow-btn').forEach(b => b.classList.remove('active'));
      const helpBtn = document.querySelector('[data-tab="help"]');
      if (helpBtn) {
        helpBtn.classList.add('active');
        state.workflow = 'help';
        $$('.workflow-content').forEach(w => w.classList.add('hidden'));
        document.querySelector('.help-workflow').classList.remove('hidden');
      }
    };
  }
  
  // Dismiss handlers
  if ($('dismissAbout')) {
    $('dismissAbout').onclick = () => {
      $('about').classList.remove('show');
    };
  }
  
  if ($('hidePreflight')) {
    $('hidePreflight').onclick = () => {
      $('preflight').classList.remove('show');
    };
  }
  
  if ($('hideCanvasHow')) {
    $('hideCanvasHow').onclick = () => {
      $('canvasHow').classList.remove('show');
    };
  }
  
  initQuestionTypes();
  initStudyComponents();
  render();
  
  // Hero content for each page
  const heroContent = {
    quiz: {
      badge: 'Canvas Quiz Builder',
      title: 'Create Perfect Quizzes in Seconds',
      subtitle: 'Transform your Panopto lectures into Canvas-ready quizzes with AI—aligned with Queen\'s Beyond Blended pedagogy',
      class: 'quiz-hero'
    },
    study: {
      badge: 'Study Guide Generator',
      title: 'Build Comprehensive Study Resources',
      subtitle: 'Generate rich, pedagogy-first study guides with flashcards, problems, and reflections from your lectures',
      class: 'study-hero'
    },
    notes: {
      badge: 'Notes to Resources',
      title: 'Transform Notes into Study Packs',
      subtitle: 'Convert your lecture notes into structured, student-ready study materials with expert guidance',
      class: 'notes-hero'
    },
    help: {
      badge: 'Getting Started',
      title: 'Welcome to Prompt Builder',
      subtitle: 'Learn how to create amazing educational resources in minutes with AI-powered tools',
      class: 'help-hero'
    }
  };
  
  // Workflow tabs
  $$('.workflow-btn').forEach(btn => {
    btn.onclick = () => {
      $$('.workflow-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.workflow = btn.dataset.tab;
      
      $$('.workflow-content').forEach(w => w.classList.add('hidden'));
      document.querySelector('.' + btn.dataset.tab + '-workflow').classList.remove('hidden');
      
      // Update hero banner
      const hero = heroContent[state.workflow];
      if (hero) {
        const heroBanner = $('heroBanner');
        heroBanner.className = 'hero-banner ' + hero.class;
        $('heroBadgeText').textContent = hero.badge;
        $('heroTitle').textContent = hero.title;
        $('heroSubtitle').textContent = hero.subtitle;
      }
      
      // Only render if not on help page
      if (state.workflow !== 'help') {
        render();
      }
    };
  });
  
  // Pedagogy selector
  $('pedagogy').addEventListener('change', () => {
    state.pedagogy = $('pedagogy').value;
    const p = PEDAGOGY[state.pedagogy];
    $('pedBrief').textContent = p?.brief || '';
    render();
  });
  
  // Preset cards - Study
  $$('.study-workflow .preset-card').forEach(card => {
    card.onclick = () => {
      $$('.study-workflow .preset-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
      state.format = card.dataset.format;
      render();
    };
  });
  
  // Preset cards - Notes
  $$('.notes-workflow .preset-card').forEach(card => {
    card.onclick = () => {
      $$('.notes-workflow .preset-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
      state.notesOutput = card.dataset.notesOutput;
      render();
    };
  });
  
  // Advanced toggles
  $('advancedToggle').onclick = () => {
    $('advancedContent').classList.toggle('open');
    $('advancedToggle').querySelector('.advanced-toggle').classList.toggle('open');
  };
  
  if ($('studyAdvancedToggle')) {
  $('studyAdvancedToggle').onclick = () => {
    $('studyAdvancedContent').classList.toggle('open');
    $('studyAdvancedToggle').querySelector('.advanced-toggle').classList.toggle('open');
  };
  }
  
  if ($('notesAdvancedToggle')) {
    $('notesAdvancedToggle').onclick = () => {
      $('notesAdvancedContent').classList.toggle('open');
      $('notesAdvancedToggle').querySelector('.advanced-toggle').classList.toggle('open');
    };
  }
  
  // Form inputs - Quiz
  $('quizTitle').oninput = e => { state.quizTitle = e.target.value; render(); };
  $('quizLang').onchange = e => { state.quizLang = e.target.value; render(); };
  $('quizCount').oninput = e => { state.quizCount = +e.target.value; render(); };
  $('quizFeedback').onchange = e => { state.quizFeedback = e.target.value; render(); };
  
  // Form inputs - Study Guide
  if ($('studyPedagogy')) {
    console.log('Wiring studyPedagogy');
    $('studyPedagogy').onchange = e => {
      console.log('Study pedagogy changed to:', e.target.value);
      state.studyPedagogy = e.target.value;
      const p = PEDAGOGY[state.studyPedagogy];
      if (p && $('studyPedBrief')) $('studyPedBrief').textContent = p.brief;
      render();
    };
  }
  if ($('studyDepth')) {
    console.log('Wiring studyDepth');
    $('studyDepth').onchange = e => {
      console.log('Study depth changed to:', e.target.value);
      state.studyDepth = e.target.value;
      render();
    };
  }
  console.log('Found sgFormat radios:', $$('input[name="sgFormat"]').length);
  $$('input[name="sgFormat"]').forEach(radio => {
    radio.onchange = e => {
      console.log('Study format changed to:', e.target.value);
      state.sgFormat = e.target.value;
      render();
    };
  });
  
  // Form inputs - From Notes
  if ($('notesPedagogy')) {
    $('notesPedagogy').onchange = e => {
      state.notesPedagogy = e.target.value;
      const p = PEDAGOGY[state.notesPedagogy];
      if (p && $('notesPedBrief')) $('notesPedBrief').textContent = p.brief;
      render();
    };
  }
  $$('input[name="notesFormat"]').forEach(radio => {
    radio.onchange = e => { state.notesFormat = e.target.value; render(); };
  });
  if ($('notesInput')) {
  $('notesInput').oninput = e => { state.notesInput = e.target.value; render(); };
  }
  
  // Copy buttons
  if ($('generateQuiz')) {
    console.log('Wiring generateQuiz button');
  $('generateQuiz').onclick = copyPrompt;
  }
  if ($('generateStudy')) {
    console.log('Wiring generateStudy button');
  $('generateStudy').onclick = copyPrompt;
  }
  if ($('generateNotes')) {
    console.log('Wiring generateNotes button');
  $('generateNotes').onclick = copyPrompt;
  }
  if ($('copyTop')) {
    console.log('Wiring copyTop button');
    $('copyTop').onclick = copyPrompt;
  }
  
  // FAQ Accordion
  $$('.faq-item').forEach(item => {
    const question = item.querySelector('.faq-question');
    question.onclick = () => {
      // Close all other items
      $$('.faq-item').forEach(other => {
        if (other !== item) {
          other.classList.remove('open');
        }
      });
      // Toggle this item
      item.classList.toggle('open');
    };
  });
}

init();
</script>

</body>
</html>
